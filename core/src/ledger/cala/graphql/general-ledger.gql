query GeneralLedgerSummary($accountSetId: UUID!) {
  accountSet(id: $accountSetId) {
    name
    btcBalances: balance(currency: "BTC") {
      ...balancesByLayer
    }
    usdtBalances: balance(currency: "USDT") {
      ...balancesByLayer
    }
    usdBalances: balance(currency: "USD") {
      ...balancesByLayer
    }
  }
}

query GeneralLedgerLineItems(
  $accountSetId: UUID!
  $journalId: UUID!
  $first: Int!
  $after: String
) {
  accountSet(id: $accountSetId) {
    members(first: $first, after: $after) {
      pageInfo {
        hasNextPage
        hasPreviousPage
      }
      edges {
        cursor
        node {
          __typename
          ... on AccountSet {
            name
            btcBalances: balance(currency: "BTC") {
              ...balancesByLayer
            }
            usdtBalances: balance(currency: "USDT") {
              ...balancesByLayer
            }
            usdBalances: balance(currency: "USD") {
              ...balancesByLayer
            }
          }
          ... on Account {
            name
            btcBalances: balance(journalId: $journalId, currency: "BTC") {
              ...balancesByLayer
            }
            usdtBalances: balance(journalId: $journalId, currency: "USDT") {
              ...balancesByLayer
            }
            usdBalances: balance(journalId: $journalId, currency: "USD") {
              ...balancesByLayer
            }
          }
        }
      }
    }
  }
}

fragment balancesByLayer on Balance {
  settled {
    ...balances
  }
  pending {
    ...balances
  }
  encumbrance {
    ...balances
  }
}

fragment balances on BalanceAmount {
  normalBalance {
    units
    currency
  }
  drBalance {
    units
    currency
  }
  crBalance {
    units
    currency
  }
}
