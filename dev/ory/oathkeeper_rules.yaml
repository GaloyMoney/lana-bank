- id: lava-core-backend
  upstream:
    url: "http://dockerhost-alias:5252"
  match:
    url: "<(http|https)>://<[a-zA-Z0-9-.:]+>/graphql"
    methods: ["POST", "GET", "OPTIONS"]
  authenticators:
    - handler: bearer_token
      config:
        token_from:
          header: X-API-KEY
        force_method: GET
    - handler: bearer_token
  authorizer:
    handler: allow
  mutators:
    - handler: id_token

- id: kratos-public
  upstream:
    url: "http://dockerhost-alias:4433"
  match:
    url: "<(http|https)>://<[a-zA-Z0-9-.:]+>/self-service/<.*>"
    methods: ["POST", "GET", "OPTIONS", "PUT", "DELETE", "PATCH"]
  authenticators:
    - handler: noop
  authorizer:
    handler: allow
  mutators:
    - handler: noop

- id: lava-core-customer-portal
  upstream:
    url: "http://dockerhost-alias:3000"
    preserve_host: true
  match:
    url: "<(http|https)>://<[a-zA-Z0-9-.:]+>/<(?!self-service).*>"
    methods: ["POST", "GET", "OPTIONS"]
  authenticators:
    - handler: anonymous
    - handler: cookie_session
  authorizer:
    handler: allow
  mutators:
    - handler: noop
    - handler: id_token
